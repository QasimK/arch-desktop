# Security settings

There are various security settings that can be done. These are all optional.

<https://wiki.archlinux.org/title/Security>

This XKCD is extremely relevant <https://xkcd.com/1200/>.

## umask

As described in `man pam_umask`, override the global umask for all logins:

`/etc/pam.d/system-login`
```
session optional pam_umask.so umask=0027
```

Override the default umask for bash:

`/etc/profile.d/umask.sh`

```
umask 0027
```

Further, set the global umask for all user services:

`/etc/systemd/system/user@.service.d/umask.conf`
```ini
[Service]
UMask=0027
```


## Restrict logins to specific accounts

`/etc/security/access.d/access.conf`
```
# Only allow local logins for root
+:root:LOCAL

# Allow me to login from anywhere
+:me:ALL

# Disallow anyone else from logging in from anywhere
-:ALL:ALL
```


## sysctl

`/etc/sysctl.d/00-harden.conf`

```ini
# Restrict ptrace to root
kernel.yama.ptrace_scope = 2

# Restrict replacing current kernel
kernel.kexec_load_disabled = 1

# Prevent spraying attacks from non-privileged code
net.core.bpf_jit_harden = 1

# Disable IPv6 to prevent VPN leaks
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
```

## Lockdown Mode

**If NOT using hibernation,** enable lockdown mode.

Kernal parameter in `/etc/kernel/cmdline`: `lockdown=confidentiality`

Rebuild boot image with `mkinitcpio -P`.


## Sign modules

**If NOT using custom kernel modules**, enforce module signatures.

Kernal parameter in `/etc/kernel/cmdline`: `module.sig_enforce=1`

Rebuild boot image with `mkinitcpio -P`.


## Resource limits

The Arch wiki describes many useful limits.

<https://wiki.archlinux.org/title/Limits.conf>


`/etc/security/limits.d/limits.conf`
```
# Prevent corefiles from being generated by default
# But allow corefiles to be temporarily enabled with ulimit -c unlimited
*           soft    core       0
*           hard    core       unlimited

# Prevent non-root users from running a process at minimal niceness
# But allow root to run a process when system is unresponsive
*           hard    nice       -19
root        hard    nice       -20

# Increase the default max number of files because it is useful
# Increase the max from 2^19 to the max-max of 2^20
*           soft    nofile     100000
*           hard    nofile     1048576

# Prevent fork-bombs from taking out the system
# But allow root to launch more processes
*           hard    nproc      10000
root        hard    nproc      100000
```

Note: Firefox does not like a limit of 1000 processes.
